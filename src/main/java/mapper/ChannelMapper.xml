<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="david.mybatis.demo.IChannelOperation">
	<sql id="getList">
		select
		channel.id channelId, channel.name channelName,
		channel.status
		channelStatus, channel.createTime channelCTime,
		website.id siteId,
		website.Name siteName, visitor.id visitorId,
		visitor.name visitorName
		from channel
		inner join website on
		channel.websiteId = website.id
		inner
		join visitor on website.visitorId
		= visitor.id
		where channel.status>0
	</sql>
	<insert id="add" parameterType="Channel" useGeneratedKeys="true"
		keyProperty="Id">
		insert into channel (Name, WebsiteId, Status,
		CreateTime)
		values (#{name}, #{websiteId}, #{status},
		#{createTime})
	</insert>
	<delete id="delete" parameterType="int">
		delete from channel where
		status>0 and id=#{id}
	</delete>
	<update id="update" parameterType="Channel">
		update channel set
		Name=#{name}, WebsiteId=#{websiteId}, Status=#{status} where status>0
		and id=#{id}
	</update>
	<select id="query" parameterType="int" resultMap="channelRs">
		<include refid="getList" />
		and channel.id = #{id}
	</select>
	<select id="getList" resultMap="channelRs">
		<include refid="getList" />
	</select>
	<select id="getListBySiteId" parameterType="BasicQueryArgs"
		resultMap="channelRs">
		<include refid="getList" />
		and website.id = #{queryId}
	</select>
	<select id="getListByVisitorId" parameterType="BasicQueryArgs"
		resultMap="channelRs">
		<include refid="getList" />
		and visitor.id = #{queryId}
	</select>
	<select id="getListByIds" resultMap="channelRs">
		<include refid="getList" />
		<if test="list!=null and list.size()>0">
			and channel.id in
			<foreach collection="list" index="index" item="item" open="("
				separator="," close=")">
				#{item}
			</foreach>
		</if>
	</select>
	<select id="retrieveListCount" resultType="int">
		select count(1) from channel where status>0
	</select>
	<resultMap type="Channel" id="channelRs">
		<id column="channelId" property="id" />
		<result column="channelName" property="name" />
		<result column="channelStatus" property="status" />
		<result column="channelCTime" property="createTime" />
		<association property="website" javaType="Visitor"
			resultMap="siteRs" />
	</resultMap>
	<resultMap type="Website" id="siteRs">
		<id column="siteId" property="id" />
		<result column="siteName" property="name" />
		<association property="visitor" javaType="Visitor"
			resultMap="visitorRs" />
	</resultMap>
	<resultMap type="Visitor" id="visitorRs">
		<id column="visitorId" property="id" />
		<result column="visitorName" property="name" />
	</resultMap>
</mapper>